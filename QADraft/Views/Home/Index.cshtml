@model QADraft.ViewModels.CombinedEventsViewModel

@{
    ViewData["Title"] = "Home Page";
    Layout = ViewBag.Layout;
}

<style>
    /* Styles for the main element of the page */
    .dashboard {
        background: #f5f5f5; /* off white */
    }

    .dashboard::after {
        content: "";
        clear: both;
    }

    .modal-open .modal {
        overflow-y: auto;
    }

    .dashboard-button {
        width: 45%; /* Adjust width as needed */
        margin: 0 5px; /* Add some spacing between items */
        float: left; /* Float items to the left */
    }

    .calendar {
        width: 45%; /* Adjust width as needed */
        margin: 0 5px; /* Add some spacing between items */
        float: left; /* Float items to the left */
    }

    .dashboard-buttons .dash-button {
        background-color: #861F41; /* EKU Maroon */
        color: white;
        margin: 15px;
        width: 200px;
        height: 200px;
        border-radius: 15px;
    }

    /* Styles for the link-bar container */
    .link-container {
        display: flex;
        position: relative;
    }
    .past-event {
        display: none; /* Hide past events by default */
    }
    /* Styles for the external links bar (vertical bar on the left) */
    .link-bar {
        background-color: #fff;
        border-right: 3px groove black;
        height: 100vh;
        width: 80px;
        position: fixed;
        top: 80px;
        left: 0;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        z-index: 0;
    }

    /* Styles for the links */
    .link-bar a img {
        display: flex;
        margin-top: 40px;
        max-height: 30px;
        max-width: 40px;
    }
</style>

<div class="text-center">
    <h1 class="display-4">Welcome, @Context.Session.GetString("FirstName")!</h1>
</div>

<!-- Side bar that contains external links -->
<div class="link-container">
    <div class="link-bar">
        <!-- Each link has an image imbedded into them. The links will open in a new tab. -->
        <a class="link" href="" onclick="openAll()">Open All</a> <!-- Shortcut to open all external links at once -->

        <a class="link" title="Argos" href="https://argosp.eku.edu/Argos/AWV/#explorer/Geeks/Equipment%20Checkout" target="_blank" rel="noopener noreferrer"><img src="~/images/argosLogo.png" alt="Argos"></a>
        <a class="link" title="Asana" href="https://app.asana.com/-/login?_gl=1*lpkqvz*_ga*MjM4ODA2MDE5LjE3MTY0NzUyMjQ.*_ga_J1KDXMCQTH*MTcxNjQ3NTIyNC4xLjEuMTcxNjQ3NTIyNC42MC4wLjEwNTc1MjYwMTA.*_fplc*bjdDRk1QMTklMkZaaXpyMlo4NUkwaVVBcFRxWW5aQzFySXQ5JTJCaUo1QjFTOGdiWDNOSUhUMUMlMkJ1d1htb3NqNks2WmtkaG51ZVBuTjViQzFtUXoxRzhsUzlpMDZRVnY4b0JTTnFYYnBIaklwRlFBcUpBS3MxdnZXNTJjNVZta1V3JTNEJTNE" target="_blank"><img src="~/images/asanaLogo.png" alt="Asana"></a>
        <a class="link" title="Docusign" href="https://account.docusign.com/oauth/auth?response_type=code&scope=all%20click.manage%20me_profile%20room_forms%20room_fields%20inproductcommunication_read%20data_explorer_signing_insights%20notary_read%20notary_write%20search_read%20search_write%20webforms_manage%20dtr%20valmod_manage%20signature&client_id=2CC56DC9-4BCD-4B55-8AB0-8BA60BAE1065&redirect_uri=https%3A%2F%2Fapps.docusign.com%2Fauthenticate&state=%7B%22widgetId%22%3A%22%40ds%2Fsend%22%2C%22xsrfToken%22%3A%22tKVf99o%2B5aaZ0d%2Bc8bp%2B%2B5D9h0qXk3IZT799yTuMknkDgNACnVPzjWynA8zxlH%2FKIcVY2vtAfu6vzo%2BvLGg8avfd%2FKn379N4HWJwxhDyHT9prk2TNzaSpmqvqllpphw7fvcWONPy47J216fgi2XsYgvYUXDY07kT4oYZGwDU6ks%3D%22%2C%22redirectUri%22%3A%22%2Fsend%22%7D" target="_blank"><img src="~/images/docusignLogo.png" alt="Docusign"></a>
        <a class="link" title="Google Drive" href="https://www.google.com/intl/en-US/drive/" target="_blank"><img src="~/images/driveLogo.png" alt="Google Drive"></a>
        <a class="link" title="EKU myMail" href="https://it.eku.edu/mso365" target="_blank"><img src="~/images/mymailLogo.png" alt="myMail"></a>
        <a class="link" title="Snipe-IT" href="https://itservice6.eku.edu/login" target="_blank"><img src="~/images/snipeitLogo.png" alt="Snipe-IT"></a>
    </div>
    <script>
        // JS for link-shortcut options. window.open() will open the given link in a new tab
        function openAll(){
            window.open("https://argosp.eku.edu/Argos/AWV/#explorer/Geeks/Equipment%20Checkout", "_blank");
            window.open("https://app.asana.com/-/login?_gl=1*lpkqvz*_ga*MjM4ODA2MDE5LjE3MTY0NzUyMjQ.*_ga_J1KDXMCQTH*MTcxNjQ3NTIyNC4xLjEuMTcxNjQ3NTIyNC42MC4wLjEwNTc1MjYwMTA.*_fplc*bjdDRk1QMTklMkZaaXpyMlo4NUkwaVVBcFRxWW5aQzFySXQ5JTJCaUo1QjFTOGdiWDNOSUhUMUMlMkJ1d1htb3NqNks2WmtkaG51ZVBuTjViQzFtUXoxRzhsUzlpMDZRVnY4b0JTTnFYYnBIaklwRlFBcUpBS3MxdnZXNTJjNVZta1V3JTNEJTNE");
            window.open("https://account.docusign.com/oauth/auth?response_type=code&scope=all%20click.manage%20me_profile%20room_forms%20room_fields%20inproductcommunication_read%20data_explorer_signing_insights%20notary_read%20notary_write%20search_read%20search_write%20webforms_manage%20dtr%20valmod_manage%20signature&client_id=2CC56DC9-4BCD-4B55-8AB0-8BA60BAE1065&redirect_uri=https%3A%2F%2Fapps.docusign.com%2Fauthenticate&state=%7B%22widgetId%22%3A%22%40ds%2Fsend%22%2C%22xsrfToken%22%3A%22tKVf99o%2B5aaZ0d%2Bc8bp%2B%2B5D9h0qXk3IZT799yTuMknkDgNACnVPzjWynA8zxlH%2FKIcVY2vtAfu6vzo%2BvLGg8avfd%2FKn379N4HWJwxhDyHT9prk2TNzaSpmqvqllpphw7fvcWONPy47J216fgi2XsYgvYUXDY07kT4oYZGwDU6ks%3D%22%2C%22redirectUri%22%3A%22%2Fsend%22%7D");
            window.open("https://www.google.com/intl/en-US/drive/");
            window.open("https://it.eku.edu/mso365");
            window.open("https://itservice6.eku.edu/login");
        }
    </script>
</div>
<button type="button" id="togglePastEvents" class="btn btn-secondary">
    Show/Hide Past Events
</button>
<body class="dashboard">
    <div class="calendar">
        <p>Event Calendar</p>
        <table class="table">
            <thead>
                <tr>
                    <th>Event Time</th>
                    <th>Event Information</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var eventItem in Model.EventsViewModel.EventList.OrderBy(e => e.EventTime))
                {
                    // Determine if event time is in the past
                    var isPastEvent = eventItem.EventTime < DateTime.Now;

                    // Apply a class based on whether the event is in the past
                    <tr class="@if (isPastEvent) { <text>past-event</text> }">
                        <td>@eventItem.EventTime</td>
                        <td>@eventItem.EventInformation</td>
                    </tr>
    }
            </tbody>
        </table>
    </div>

    <!-- Button to trigger modal -->
    <button type="button" onclick = "setCurrentDateTime()" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEventModal">
        Add New Event
    </button>

    <!-- Modal for adding new event -->
    <div class="modal fade" id="addEventModal" tabindex="-1" aria-labelledby="addEventModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEventModalLabel">Add New Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Form that posts to the EventController's AddEvent action -->
                    <form asp-controller="Event" asp-action="AddEvent" method="post">
                        <div class="form-group">
                            <label asp-for="NewEvent.EventTime" class="control-label">Event Time</label>
                            <input asp-for="NewEvent.EventTime" class="form-control" type="datetime-local" id="eventTimeInput" />
                            <span asp-validation-for="NewEvent.EventTime" class="text-danger"></span>
                        </div>
                        <div class="form-group">
                            <label asp-for="NewEvent.EventInformation" class="control-label">Event Information</label>
                            <input asp-for="NewEvent.EventInformation" class="form-control" placeholder="Enter Event Info" />
                            <span asp-validation-for="NewEvent.EventInformation" class="text-danger"></span>
                        </div>
                        <button type="submit" onclick = "" class="btn btn-primary">Add Event</button>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <!-- JQuery and Bootstrap JS from CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Site-specific JavaScript -->
    <script src="~/js/site.js" asp-append-version="true"></script>
    
    <!-- Validation Scripts Partial -->
    <partial name="_ValidationScriptsPartial" />

    <!-- Script to set the default date and time in the event time input -->
    <script>
        $(document).ready(function () {
            function setCurrentDateTime() {
                const now = new Date();
                const year = now.getFullYear();
                const month = ('0' + (now.getMonth() + 1)).slice(-2);
                const day = ('0' + now.getDate()).slice(-2);
                const hours = ('0' + now.getHours()).slice(-2);
                const minutes = ('0' + now.getMinutes()).slice(-2);

                const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
                $('#eventTimeInput').val(formattedDateTime);
            }

            setCurrentDateTime();

            // Set the current date and time when the modal is opened
            $('#addEventModal').on('shown.bs.modal', setCurrentDateTime);
        });

        function setCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = ('0' + (now.getMonth() + 1)).slice(-2);
            const day = ('0' + now.getDate()).slice(-2);
            const hours = ('0' + now.getHours()).slice(-2);
            const minutes = ('0' + now.getMinutes()).slice(-2);

            const formattedDateTime = `${year}-${month}-${day}T${hours}:${minutes}`;
            $('#eventTimeInput').val(formattedDateTime);

            // Set the minimum date and time to current date and time
            $('#eventTimeInput').attr('min', formattedDateTime);
        }

        $('form').submit(function (event) {
            const selectedDateTime = new Date($('#eventTimeInput').val());
            const currentDateTime = new Date();

            if (selectedDateTime < currentDateTime) {
                alert('Please select a date and time that is after the current date and time.');
                event.preventDefault(); // Prevent form submission
            }
        });
        $(document).ready(function () {
             // Toggle button click event
            $('#togglePastEvents').click(function () {
            $('.past-event').toggle(); // Toggle visibility of past events
        });
        });

    </script>


}
</body>

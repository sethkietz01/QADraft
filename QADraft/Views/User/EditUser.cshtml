@model QADraft.Models.User

@{
    ViewData["Title"] = "Edit User";
}

<style>
    .form-group select
    {
        margin-bottom: 20px;
    }

    .confirmation-dialog {
        display: none;
        position: fixed;
        z-index: 9999;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: #d9f0ff;
        border: 1px solid #ccc;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
        max-width: 300px;
    }

    .confirmation-content {
        text-align: center;
    }

    .confirmation-buttons {
        margin-top: 20px;
    }

    .confirmation-buttons button {
        padding: 10px 20px;
        margin: 0 10px;
        cursor: pointer;
    }

    .edit-user-btn {
        color: #fff;
        background-color: #861F41;
        border-color: #861F41;
    }
        .edit-user-btn:hover{
            color: #fff;
            background-color: #b31f4f;
            border-color: #E6A65D
        }

</style>

<partial name="_GeeksMenu" />
<h2>Edit User</h2>

<!-- Form to get updated information on the user being edited -->
<form asp-controller="User" asp-action="EditUser" method="post">
    <div class="form-group">
        <label asp-for="Username" class="control-label">Username</label>
        <input asp-for="Username" class="form-control" />
        <span asp-validation-for="Username" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Password" class="control-label">New Password</label>
        <input id="password-field" asp-for="Password" class="form-control" value=""/>
        <span asp-validation-for="Password" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="FirstName" class="control-label">First Name</label>
        <input asp-for="FirstName" class="form-control" />
        <span asp-validation-for="FirstName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="LastName" class="control-label">Last Name</label>
        <input asp-for="LastName" class="form-control" />
        <span asp-validation-for="LastName" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Email" class="control-label">Email Address</label>
        <input asp-for="Email" class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>
    <div class="form-group">
        <label asp-for="Role" class="control-label">Role</label>
        <select asp-for="Role" class="form-control" id="natureSelect">
            <option value="">Select Role</option>
            <option value="Geek">Geek</option>
            <option value="Coordinator">Coordinator</option>
            <option value="Admin">Admin</option>
        </select>
        <span asp-validation-for="Role" class="text-danger"></span>
    </div>
    <div class="form-group">
        <input type="submit" value="Edit User" class="btn btn-primary" hidden/>

    </div>
</form>

<div>
    <button onclick="openConfirmation()" class="btn buttons form-buttons">Save Changes</button>
</div>

<!-- Edit User Confirm Popup -->
<div id="confirmationDialog" class="confirmation-dialog">
    <div class="confirmation-content">
        <p>Press Confirm to Edit this User's information.'</p>
        <div class="confirmation-buttons">
            <button class="btn btn-danger" onclick="confirmEdit()">Confirm</button>
            <button class="btn btn-secondary" onclick="closeConfirmation()">Cancel</button>
        </div>
    </div>
</div>


@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>
        function openConfirmation() {
            console.log("OpenConfirmation");

            // Show the confirmation dialog
            document.getElementById('confirmationDialog').style.display = 'block';
        }

        function closeConfirmation() {
            document.getElementById('confirmationDialog').style.display = 'none';
        }

        function confirmEdit() {
            closeConfirmation();
            password = document.getElementById("password-field").value.trim();
            if (password.value == "")
                password.value = "-";

             if (password.length < 8) {
                alert("Password must be at least 8 characters long.");
                return false;
            } else if (!/[A-Z]/.test(password))
            {
                alert("Password must contain at least one uppercase letter.");
                return false;   
            } else if (!/[^A-Za-z0-9]/.test(password)) {
                alert("Password must contain at least one special character.");
                return false;
            } else if (!/\d/.test(password)) {
                alert("Password must contain at least one numeric character.");
                return false;
            } else {
                closeConfirmation();
                // If password meets criteria, proceed with form submission
                document.querySelector('input[type="submit"][value="Edit User"]').click();
                return true;
            }

            console.log(password.value);
            document.querySelector('input[type="submit"][value="Edit User"]').click();
            console.log("Clicked");
            closeConfirmationDialog();
            return false;
        }
    </script>
}
